!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(t="undefined"!=typeof globalThis?globalThis:t||self).ObiusmDom=r()}(this,(function(){"use strict";var t,r;return function(t){t.KEYFRAME="keyframe",t.MOVE="move",t.ROTATE="rotate",t.TRANSLATE="translate",t.ATTRIBUTE="attribute",t.WAIT="wait",t.STOP="stop"}(t||(t={})),function(t){t[t.STOP=0]="STOP",t[t.PLAYING=1]="PLAYING",t[t.PAUSE=2]="PAUSE"}(r||(r={})),function(){function n(n,e){this.originTransitionProperty=[],this.stylesRecordQueue=[],this.currentTaskProcessType=t.STOP,this.processStatus=r.STOP,this.target=n;var i;i=window.getComputedStyle(this.target,null).position,this.target.style.position="relative"==i?"relative":"absolute",this.Animation=e,this.init()}return n.install=function(t){this.mot=t,t.register("dom",(function(t,r){return new n(t,r)}))},n.prototype.init=function(){this.originTransform=this.getOriginStyleTransform(this.target);var t=this.Animation.actions;this.taskQueue=t.children||[],this.initStyle(this.taskQueue)},n.prototype.update=function(t,r){null!==t&&(this.originTransform=this.splitStyleToArray(t)),null!==r&&(this.originTransitionProperty=this.splitTransitionPropertyToArray(r))},n.prototype.getOriginStyleTransform=function(t){var r=t.style.transform;return""===(r=""===r?window.getComputedStyle(t,null).transform:r)||null===r||"none"===r?[]:this.splitStyleToArray(r)},n.prototype.initStyle=function(t){for(var r=this,n=!1,e=function(){r.target.style.left=window.getComputedStyle(r.target,null).left||"0px",r.target.style.top=window.getComputedStyle(r.target,null).top||"0px"},i=0,o=t.length;i<o;i++){var a=t[i];if("group"===a.type){var s=-1!==a.children.findIndex((function(t){return"move"===t.action}));!n&&s&&e(),n=!0}else"move"===a.action&&(!n&&e(),n=!0)}},n.prototype.render=function(){var n=this,e=this.getStyleFromTaskQueue(this.taskQueue),i=e.length,o=0,a=function(s,u){void 0===u&&(u=-1);var p=function(){n.processStatus=r.PLAYING;var u=s.style;for(var p in n.currentTaskProcessType=t[s.type.toUpperCase()],u)n.target.style[p]=u[p];++o<i&&a(e[o],0===o?0:e[o-1].duration)};-1===u?p():-2===u?requestAnimationFrame((function(){p()})):setTimeout((function(){p()}),u)};return setTimeout((function(){a(e[0])}),0),this},n.prototype.mergeTransForm=function(t,r){var n=this.splitStyleToArray(r),e=r;return t.forEach((function(t){for(var r=!1,i=0,o=n.length;i<o;i++)if(t[0][0]==n[i][0][0]){r=!0;break}r||(e=e+" "+t[0]+"("+t[1]+")")})),e},n.prototype.mergeTransitionProperty=function(t,r){var n=this.splitTransitionPropertyToArray(r),e=r;return t.forEach((function(t){n.includes(t)||(e=e+","+t)})),e},n.prototype.getStyleFromTaskQueue=function(t){var r=this,n=[];return t.forEach((function(t){"group"==t.type?(t.children.forEach((function(e){e.duration=t.duration,n.push({style:r.transferAction(e),duration:-1,type:t.action})})),n.push({style:{},duration:t.duration,type:t.action})):"wait"==t.action?n.push({style:{},duration:t.time,type:t.action}):"statusOn"==t.action||"statusOff"==t.action?n.push({style:{},duration:t.duration,status:t.action,type:t.action}):"path"===t.action?t.points.forEach((function(r){n.push({style:{left:r.x+"px",top:r.y+"px"},duration:-2,type:t.action})})):n.push({style:r.transferAction(t),duration:t.duration,type:t.action})})),n},n.prototype.transferAction=function(t){return{translate:this.translate,rotate:this.rotate,scale:this.scale,attribute:this.attribute,move:this.move,keyframe:this.keyframe}[t.action].bind(this)(t)},n.prototype.translate=function(t){var r=void 0!==t.z?"translate3d("+t.x+","+t.y+")":"translate("+t.x+","+t.y+","+t.z+")",n=t.duration+"ms",e=""+t.timeFunction,i="transform";return r=this.mergeTransForm(this.originTransform,r),i=this.mergeTransitionProperty(this.originTransitionProperty,i),this.update(r,i),{transform:r,transitionDuration:n,transitionTimingFunction:e,transitionProperty:i}},n.prototype.move=function(t){var r=""+(Number(t.x)?t.x+"px":t.x),n=""+(Number(t.y)?t.y+"px":t.y),e=t.duration+"ms",i=""+t.timeFunction,o="left,top";return o=this.mergeTransitionProperty(this.originTransitionProperty,o),this.update(null,o),{left:r,top:n,transitionDuration:e,transitionTimingFunction:i,transitionProperty:o}},n.prototype.scale=function(t){var r=void 0!==t.z?"scale3d("+t.x+","+t.y+","+t.z+")":"scale("+t.x+","+t.y+")",n=t.duration+"ms",e=""+t.timeFunction,i=""+t.transformOrigin,o="transform";return r=this.mergeTransForm(this.originTransform,r),o=this.mergeTransitionProperty(this.originTransitionProperty,o),this.update(r,o),{transform:r,transitionDuration:n,transitionTimingFunction:e,transitionProperty:o,transformOrigin:i}},n.prototype.rotate=function(t){var r=void 0!==t.x||void 0!==t.y?"rotate3d("+t.x+"deg,"+t.y+"deg,"+t.z+"deg)":"rotate("+t.z+"deg)",n=t.duration+"ms",e=""+t.timeFunction,i=""+t.transformOrigin,o="transform";return r=this.mergeTransForm(this.originTransform,r),o=this.mergeTransitionProperty(this.originTransitionProperty,o),this.update(r,o),{transform:r,transformOrigin:i,transitionDuration:n,transitionTimingFunction:e,transitionProperty:o}},n.prototype.attribute=function(t){var r,n=t.duration+"ms",e=""+t.timeFunction,i=""+this.humpParse(t.key);return i=this.mergeTransitionProperty(this.originTransitionProperty,i),this.update(null,i),(r={})[t.key]=t.value,r.transitionDuration=n,r.transitionTimingFunction=e,r.transitionProperty=i,r},n.prototype.keyframe=function(t){var r=this,n="";t.keyframe.forEach((function(t){var e,i="";for(var o in t.action)i+=r.humpParse(o)+":"+t.action[o]+";";e=t.process+" {"+i+"}",n+=e})),this.insertKeyFrame("@keyframes obiusm-"+t.uid+" {"+n+"}");var e="obiusm-class-"+t.uid;this.addStylesheetRules([["."+e,["animation","obiusm-"+t.uid+"  \n        "+(t.duration+"ms"||"0.4s")+" \n        "+(t.timeFunction||"ease")+" \n        "+(t.delay||"0s")+" \n        "+(void 0===t.iterationCount?1:t.iterationCount)+" \n        "+(void 0===t.direction?"normal":t.direction)+" \n        "+(void 0===t.fillMode?"none":t.fillMode)+" \n        "]]]),this.addClassName(this.target,e)},n.prototype.humpParse=function(t){var r=t.match(/([a-z]+)|([A-Z]{1}[a-z]+)/g),n="";return r.forEach((function(t,r){0===r?n=t:(t=t.toLowerCase(),n=n+"-"+t)})),n},n.prototype.splitStyleToArray=function(t){return t.match(/[a-zA-Z]+\s*?\(.*?\)/gms).map((function(t){try{return[[t.match(/([a-zA-Z]*?)\(/)[1]],t.match(/\((.*)\)/)[1]]}catch(t){throw new Error("There is something wrong with transform style")}}))},n.prototype.splitTransitionPropertyToArray=function(t){return t.split(",").filter((function(t){return""!==t||void 0!==t}))},n.prototype.addStylesheetRules=function(t){var r=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(r),window.createPopup||r.appendChild(document.createTextNode(""));for(var n=document.styleSheets[document.styleSheets.length-1],e=0,i=t.length;e<i;e++){var o=1,a=t[e],s=a[0],u="";"[object Array]"===Object.prototype.toString.call(a[1][0])&&(a=a[1],o=0);for(var p=a.length;o<p;o++){var c=a[o];u+=c[0]+":"+c[1]+(c[2]?" !important":"")+";\n"}n.insertRule?n.insertRule(s+"{"+u+"}",n.cssRules.length):n.addRule(s,u,-1)}},n.prototype.insertKeyFrame=function(t){try{var r=document.createElement("style");r.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(r)}catch(t){console.error("insertKeyFrame error",t)}},n.prototype.addClassName=function(t,r){var n=t.className;n=n+" "+r,t.className=n},n.prototype.removeClassName=function(t,r){var n=t.className;n=n.replace(r,""),t.className=n},n.prototype.pause=function(){},n.prototype.play=function(){},n.pluginName="DomRender",n.installed=!1,n}()}));
