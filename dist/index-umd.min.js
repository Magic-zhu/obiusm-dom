!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(t="undefined"!=typeof globalThis?globalThis:t||self)["mot-plugin-dom"]=r()}(this,(function(){"use strict";return function(){function t(t,r){this.target=t;var e;e=window.getComputedStyle(this.target,null).position,this.target.style.position="relative"==e?"relative":"absolute",this.Animation=r,this.init()}return t.install=function(r){this.mot=r,r.register("dom",(function(r,e){return new t(r,e)}))},t.prototype.init=function(){this.originTransform=this.getOriginStyleTransform(this.target),this.originTransitionProperty=[];var t=this.Animation.actions;this.taskQueue=t.children||[],this.initStyle(this.taskQueue)},t.prototype.update=function(t,r){null!==t&&(this.originTransform=this.splitStyleToArray(t)),null!==r&&(this.originTransitionProperty=this.splitTransitionPropertyToArray(r))},t.prototype.getOriginStyleTransform=function(t){var r=t.style.transform;return""===(r=""===r?window.getComputedStyle(t,null).transform:r)||null===r||"none"===r?[]:this.splitStyleToArray(r)},t.prototype.initStyle=function(t){for(var r=this,e=!1,n=function(){r.target.style.left=window.getComputedStyle(r.target,null).left||"0px",r.target.style.top=window.getComputedStyle(r.target,null).top||"0px"},i=0,o=t.length;i<o;i++){var s=t[i];if("group"===s.type){var a=-1!==s.children.findIndex((function(t){return"move"===t.action}));!e&&a&&n(),e=!0}else"move"===s.action&&(!e&&n(),e=!0)}},t.prototype.render=function(){var r=this;t.mot.emit("domRenderBeforeRender",this);var e=this.getStyleFromTaskQueue(this.taskQueue),n=e.length,i=0,o=function(t,s){void 0===s&&(s=-1);var a=function(){if("statusOn"!==t.status&&"statusOff"!==t.status){var s=t.style;for(var a in s)r.target.style[a]=s[a]}else{({statusOn:r.renderStatusOn.bind(r),statusOff:r.renderStatusOff.bind(r)})[t.status](r.taskQueue[i])}++i<n&&o(e[i],0===i?0:e[i-1].duration)};-1===s?a():-2===s?requestAnimationFrame((function(){a()})):setTimeout((function(){a()}),s)};setTimeout((function(){o(e[0])}),0)},t.prototype.renderStatusOn=function(t){if(t.status&&"rotate"===t.status.type&&""!==t.status.description){var r="rotate"+(new Date).getTime(),e=void 0,n=void 0,i=t.status.description.split(",")[0].trim(),o=t.status.description.split(",")[1].trim();"x"!==i&&"X"!==i||(e="rotateX(0)",n="rotateX(360deg)"),"y"!==i&&"Y"!==i||(e="rotateY(0)",n="rotateY(360deg)"),"z"!==i&&"Z"!==i||(e="rotateZ(0)",n="rotateZ(360deg)"),this.insertKeyFrame("@keyframes "+r+" {\n          from {transform:"+e+";}\n          to {transform:"+n+";\n          transform-origin:"+t.status.transformOrigin+"}}\n        }");var s="mot-class-rotate-"+(new Date).getTime();this.addStylesheetRules([["."+s,["animation",r+" "+o]]]),this.addClassName(this.target,s)}if(t.status&&"scale"===t.status.type&&""!==t.status.description){var a="scale"+(new Date).getTime(),u=(i=t.status.description.split(",")[0].trim()).split("|")[0],l=i.split("|")[1],p=i.split("|")[2],m=i.split("|")[3];o=t.status.description.split(",")[1].trim(),e="scale("+u+","+l+")",n="scale("+p+","+m+")";this.insertKeyFrame("@keyframes "+a+" {\n        from {transform:"+e+";\n        transform-origin:"+t.status.transformOrigin+"}\n        to {transform:"+n+";\n        transform-origin:"+t.status.transformOrigin+"}\n      }");s="mot-class-scale-"+(new Date).getTime();this.addStylesheetRules([["."+s,["animation",a+" "+o]]]),this.addClassName(this.target,s)}},t.prototype.renderStatusOff=function(t){var r=this,e=t.status.type;this.target.className.split(" ").filter((function(t){return-1!==t.indexOf("mot-class-"+e)})).forEach((function(t){r.removeClassName(r.target,t)}))},t.prototype.mergeTransForm=function(t,r){var e=this.splitStyleToArray(r),n=r;return t.forEach((function(t){for(var r=!1,i=0,o=e.length;i<o;i++)if(t[0][0]==e[i][0][0]){r=!0;break}r||(n=n+" "+t[0]+"("+t[1]+")")})),n},t.prototype.mergeTransitionProperty=function(t,r){var e=this.splitTransitionPropertyToArray(r),n=r;return t.forEach((function(t){e.includes(t)||(n=n+","+t)})),n},t.prototype.getStyleFromTaskQueue=function(t){var r=this,e=[];return t.forEach((function(t){"group"==t.type?(t.children.forEach((function(n){n.duration=t.duration,e.push({style:r.transferAction(n),duration:-1})})),e.push({style:{},duration:t.duration})):"wait"==t.action?e.push({style:{},duration:t.time}):"statusOn"==t.action||"statusOff"==t.action?e.push({style:{},duration:t.duration,status:t.action}):"path"===t.action?t.points.forEach((function(t){e.push({style:{left:t.x+"px",top:t.y+"px"},duration:-2})})):e.push({style:r.transferAction(t),duration:t.duration})})),e},t.prototype.transferAction=function(t){return{translate:this.translate,rotate:this.rotate,scale:this.scale,attribute:this.attribute,move:this.move}[t.action].bind(this)(t)},t.prototype.translate=function(t){var r=void 0!==t.z?"translate3d("+t.x+","+t.y+")":"translate("+t.x+","+t.y+","+t.z+")",e=t.duration+"ms",n=""+t.timeFunction,i="transform";return r=this.mergeTransForm(this.originTransform,r),i=this.mergeTransitionProperty(this.originTransitionProperty,i),this.update(r,i),{transform:r,transitionDuration:e,transitionTimingFunction:n,transitionProperty:i}},t.prototype.move=function(t){var r=""+(Number(t.x)?t.x+"px":t.x),e=""+(Number(t.y)?t.y+"px":t.y),n=t.duration+"ms",i=""+t.timeFunction,o="left,top";return o=this.mergeTransitionProperty(this.originTransitionProperty,o),this.update(null,o),{left:r,top:e,transitionDuration:n,transitionTimingFunction:i,transitionProperty:o}},t.prototype.scale=function(t){var r=void 0!==t.z?"scale3d("+t.x+","+t.y+","+t.z+")":"scale("+t.x+","+t.y+")",e=t.duration+"ms",n=""+t.timeFunction,i=""+t.transformOrigin,o="transform";return r=this.mergeTransForm(this.originTransform,r),o=this.mergeTransitionProperty(this.originTransitionProperty,o),this.update(r,o),{transform:r,transitionDuration:e,transitionTimingFunction:n,transitionProperty:o,transformOrigin:i}},t.prototype.rotate=function(t){var r=void 0!==t.x||void 0!==t.y?"rotate3d("+t.x+"deg,"+t.y+"deg,"+t.z+"deg)":"rotate("+t.z+"deg)",e=t.duration+"ms",n=""+t.timeFunction,i=""+t.transformOrigin,o="transform";return r=this.mergeTransForm(this.originTransform,r),o=this.mergeTransitionProperty(this.originTransitionProperty,o),this.update(r,o),{transform:r,transformOrigin:i,transitionDuration:e,transitionTimingFunction:n,transitionProperty:o}},t.prototype.attribute=function(t){var r,e=t.duration+"ms",n=""+t.timeFunction,i=""+this.humpParse(t.key);return i=this.mergeTransitionProperty(this.originTransitionProperty,i),this.update(null,i),(r={})[t.key]=t.value,r.transitionDuration=e,r.transitionTimingFunction=n,r.transitionProperty=i,r},t.prototype.humpParse=function(t){var r=t.match(/([a-z]+)|([A-Z]{1}[a-z]+)/g),e="";return r.forEach((function(t,r){0===r?e=t:(t=t.toLowerCase(),e=e+"-"+t)})),e},t.prototype.splitStyleToArray=function(t){return t.match(/[a-zA-Z]+\s*?\(.*?\)/gms).map((function(t){try{return[[t.match(/([a-zA-Z]*?)\(/)[1]],t.match(/\((.*)\)/)[1]]}catch(t){throw new Error("There is something wrong with transform style")}}))},t.prototype.splitTransitionPropertyToArray=function(t){return t.split(",").filter((function(t){return""!==t||void 0!==t}))},t.prototype.addStylesheetRules=function(t){var r=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(r),window.createPopup||r.appendChild(document.createTextNode(""));for(var e=document.styleSheets[document.styleSheets.length-1],n=0,i=t.length;n<i;n++){var o=1,s=t[n],a=s[0],u="";"[object Array]"===Object.prototype.toString.call(s[1][0])&&(s=s[1],o=0);for(var l=s.length;o<l;o++){var p=s[o];u+=p[0]+":"+p[1]+(p[2]?" !important":"")+";\n"}e.insertRule?e.insertRule(a+"{"+u+"}",e.cssRules.length):e.addRule(a,u,-1)}},t.prototype.insertKeyFrame=function(t){try{var r=document.createElement("style");r.type="text/css",r.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(r)}catch(t){console.error("insertKeyFrame error",t)}},t.prototype.addClassName=function(t,r){var e=t.className;e=e+" "+r,t.className=e},t.prototype.removeClassName=function(t,r){var e=t.className;e=e.replace(r,""),t.className=e},t.pluginName="DomRender",t.installed=!1,t}()}));
