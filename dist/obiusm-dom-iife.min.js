var ObiusmDom=function(){"use strict";return function(){function t(t,r){this.originTransitionProperty=[],this.stylesRecordQueue=[],this.target=t;var n;n=window.getComputedStyle(this.target,null).position,this.target.style.position="relative"==n?"relative":"absolute",this.Animation=r,this.init()}return t.install=function(r){this.mot=r,r.register("dom",(function(r,n){return new t(r,n)}))},t.prototype.init=function(){this.originTransform=this.getOriginStyleTransform(this.target);var t=this.Animation.actions;this.taskQueue=t.children||[],this.initStyle(this.taskQueue)},t.prototype.update=function(t,r){null!==t&&(this.originTransform=this.splitStyleToArray(t)),null!==r&&(this.originTransitionProperty=this.splitTransitionPropertyToArray(r))},t.prototype.getOriginStyleTransform=function(t){var r=t.style.transform;return""===(r=""===r?window.getComputedStyle(t,null).transform:r)||null===r||"none"===r?[]:this.splitStyleToArray(r)},t.prototype.initStyle=function(t){for(var r=this,n=!1,i=function(){r.target.style.left=window.getComputedStyle(r.target,null).left||"0px",r.target.style.top=window.getComputedStyle(r.target,null).top||"0px"},e=0,o=t.length;e<o;e++){var a=t[e];if("group"===a.type){var s=-1!==a.children.findIndex((function(t){return"move"===t.action}));!n&&s&&i(),n=!0}else"move"===a.action&&(!n&&i(),n=!0)}},t.prototype.render=function(){var r=this;t.mot.emit("domRenderBeforeRender",this);var n=this.getStyleFromTaskQueue(this.taskQueue),i=n.length,e=0,o=function(t,a){void 0===a&&(a=-1);var s=function(){var a=t.style;for(var s in a)r.target.style[s]=a[s];++e<i&&o(n[e],0===e?0:n[e-1].duration)};-1===a?s():-2===a?requestAnimationFrame((function(){s()})):setTimeout((function(){s()}),a)};setTimeout((function(){o(n[0])}),0)},t.prototype.mergeTransForm=function(t,r){var n=this.splitStyleToArray(r),i=r;return t.forEach((function(t){for(var r=!1,e=0,o=n.length;e<o;e++)if(t[0][0]==n[e][0][0]){r=!0;break}r||(i=i+" "+t[0]+"("+t[1]+")")})),i},t.prototype.mergeTransitionProperty=function(t,r){var n=this.splitTransitionPropertyToArray(r),i=r;return t.forEach((function(t){n.includes(t)||(i=i+","+t)})),i},t.prototype.getStyleFromTaskQueue=function(t){var r=this,n=[];return t.forEach((function(t){"group"==t.type?(t.children.forEach((function(i){i.duration=t.duration,n.push({style:r.transferAction(i),duration:-1})})),n.push({style:{},duration:t.duration})):"wait"==t.action?n.push({style:{},duration:t.time}):"statusOn"==t.action||"statusOff"==t.action?n.push({style:{},duration:t.duration,status:t.action}):"path"===t.action?t.points.forEach((function(t){n.push({style:{left:t.x+"px",top:t.y+"px"},duration:-2})})):n.push({style:r.transferAction(t),duration:t.duration})})),n},t.prototype.transferAction=function(t){return{translate:this.translate,rotate:this.rotate,scale:this.scale,attribute:this.attribute,move:this.move,keyframe:this.keyframe}[t.action].bind(this)(t)},t.prototype.translate=function(t){var r=void 0!==t.z?"translate3d("+t.x+","+t.y+")":"translate("+t.x+","+t.y+","+t.z+")",n=t.duration+"ms",i=""+t.timeFunction,e="transform";return r=this.mergeTransForm(this.originTransform,r),e=this.mergeTransitionProperty(this.originTransitionProperty,e),this.update(r,e),{transform:r,transitionDuration:n,transitionTimingFunction:i,transitionProperty:e}},t.prototype.move=function(t){var r=""+(Number(t.x)?t.x+"px":t.x),n=""+(Number(t.y)?t.y+"px":t.y),i=t.duration+"ms",e=""+t.timeFunction,o="left,top";return o=this.mergeTransitionProperty(this.originTransitionProperty,o),this.update(null,o),{left:r,top:n,transitionDuration:i,transitionTimingFunction:e,transitionProperty:o}},t.prototype.scale=function(t){var r=void 0!==t.z?"scale3d("+t.x+","+t.y+","+t.z+")":"scale("+t.x+","+t.y+")",n=t.duration+"ms",i=""+t.timeFunction,e=""+t.transformOrigin,o="transform";return r=this.mergeTransForm(this.originTransform,r),o=this.mergeTransitionProperty(this.originTransitionProperty,o),this.update(r,o),{transform:r,transitionDuration:n,transitionTimingFunction:i,transitionProperty:o,transformOrigin:e}},t.prototype.rotate=function(t){var r=void 0!==t.x||void 0!==t.y?"rotate3d("+t.x+"deg,"+t.y+"deg,"+t.z+"deg)":"rotate("+t.z+"deg)",n=t.duration+"ms",i=""+t.timeFunction,e=""+t.transformOrigin,o="transform";return r=this.mergeTransForm(this.originTransform,r),o=this.mergeTransitionProperty(this.originTransitionProperty,o),this.update(r,o),{transform:r,transformOrigin:e,transitionDuration:n,transitionTimingFunction:i,transitionProperty:o}},t.prototype.attribute=function(t){var r,n=t.duration+"ms",i=""+t.timeFunction,e=""+this.humpParse(t.key);return e=this.mergeTransitionProperty(this.originTransitionProperty,e),this.update(null,e),(r={})[t.key]=t.value,r.transitionDuration=n,r.transitionTimingFunction=i,r.transitionProperty=e,r},t.prototype.keyframe=function(t){var r=this,n="";t.keyframe.forEach((function(t){var i,e="";for(var o in t.action)e+=r.humpParse(o)+":"+t.action[o]+";";i=t.process+" {"+e+"}",n+=i})),this.insertKeyFrame("@keyframes obiusm-"+t.uid+" {"+n+"}");var i="obiusm-class-"+t.uid;this.addStylesheetRules([["."+i,["animation","obiusm-"+t.uid+"  \n        "+(t.duration+"ms"||"0.4s")+" \n        "+(t.timeFunction||"ease")+" \n        "+(t.delay||"0s")+" \n        "+(void 0===t.iterationCount?1:t.iterationCount)+" \n        "+(void 0===t.direction?"normal":t.direction)+" \n        "+(void 0===t.fillMode?"none":t.fillMode)+" \n        "]]]),this.addClassName(this.target,i)},t.prototype.humpParse=function(t){var r=t.match(/([a-z]+)|([A-Z]{1}[a-z]+)/g),n="";return r.forEach((function(t,r){0===r?n=t:(t=t.toLowerCase(),n=n+"-"+t)})),n},t.prototype.splitStyleToArray=function(t){return t.match(/[a-zA-Z]+\s*?\(.*?\)/gms).map((function(t){try{return[[t.match(/([a-zA-Z]*?)\(/)[1]],t.match(/\((.*)\)/)[1]]}catch(t){throw new Error("There is something wrong with transform style")}}))},t.prototype.splitTransitionPropertyToArray=function(t){return t.split(",").filter((function(t){return""!==t||void 0!==t}))},t.prototype.addStylesheetRules=function(t){var r=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(r),window.createPopup||r.appendChild(document.createTextNode(""));for(var n=document.styleSheets[document.styleSheets.length-1],i=0,e=t.length;i<e;i++){var o=1,a=t[i],s=a[0],u="";"[object Array]"===Object.prototype.toString.call(a[1][0])&&(a=a[1],o=0);for(var p=a.length;o<p;o++){var l=a[o];u+=l[0]+":"+l[1]+(l[2]?" !important":"")+";\n"}n.insertRule?n.insertRule(s+"{"+u+"}",n.cssRules.length):n.addRule(s,u,-1)}},t.prototype.insertKeyFrame=function(t){try{var r=document.createElement("style");r.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(r)}catch(t){console.error("insertKeyFrame error",t)}},t.prototype.addClassName=function(t,r){var n=t.className;n=n+" "+r,t.className=n},t.prototype.removeClassName=function(t,r){var n=t.className;n=n.replace(r,""),t.className=n},t.prototype.pause=function(){},t.prototype.play=function(){},t.pluginName="DomRender",t.installed=!1,t}()}();
